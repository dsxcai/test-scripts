#!/bin/bash
( cd ../TOT/vendor_htc_flounder
  _h=$(git log -1 --format=%h)
  cp bootloader.img bootloader_orig.img
  cp ../../test/signed/{tos.img,rawbct.img,nvtbootwb0.bin,nvtboot.img,hboot.img,mts_preboot_prod,mts_prod} .
  ./mkimg.sh
  cp bootloader.img bootloader_new.img
  for((i=1; i<=10; ++i)); do
	echo "##### Test $i"
	sudo ../tools/bin/fastboot $* oem set_unlock_ability 1
	sudo ../tools/bin/fastboot $* oem set_flash_state 1
	sudo ../tools/bin/fastboot $* flash bootloader bootloader_orig.img reboot-bootloader
	sleep 2s
	sudo ../tools/bin/fastboot $* flash bootloader bootloader_new.img reboot-bootloader
	sleep 2s
  done;
  echo "Test done."
  rm -f bootloader_new.img bootloader_orig.img
  git reset --hard $_h
 )
sudo ../TOT/tools/bin/fastboot $* reboot
